<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matching Game - Test Your Memory</title>
    <!-- Cache Control: Although using a CDN, the version parameter is included for good deployment practice. -->
    <script src="https://cdn.tailwindcss.com?v=1.0"></script>
    
    <!-- Font configuration: Inter as a robust alternative to Platform Medium -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;800&display=swap" rel="stylesheet">
    
    <style>
        /* Core color definitions */
        :root {
            --flamingo-pink: #FF79AC;
            --eerie-black: #121118;
            --white: #FFFFFF;
            /* Feedback colors */
            --green-light: #D1FAE5; /* Verde claro */
            --red-light: #FEE2E2;   /* Rojo claro */
            /* Initial button color: light pink (10% opacity of flamingo pink) */
            --button-initial-bg: rgba(255, 121, 172, 0.1); 
            /* To simulate Platform Medium, we use Inter 800 (Extra Bold) */
            --platform-medium-font: 'Inter', sans-serif;
        }

        body {
            font-family: var(--platform-medium-font);
            background-color: var(--white);
            color: var(--eerie-black);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 20px;
        }

        /* Title style */
        .main-title {
            color: var(--flamingo-pink);
            font-weight: 800; /* Extra Bold */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Base game button style */
        .word-button {
            background-color: var(--button-initial-bg);
            color: var(--eerie-black);
            border: 0;
            border-bottom: 3px solid var(--flamingo-pink); /* Flamingo pink bottom border */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            padding: 8px 12px;
            font-size: 0.875rem; /* Small */
            font-weight: 500; /* Medium */
            border-radius: 4px; /* Slightly rounded corners */
            width: 100%; /* For column layout */
            text-align: center;
            white-space: nowrap; /* Prevents text wrapping */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .word-button:hover:not(.selected):not(.matched) {
            background-color: rgba(255, 121, 172, 0.3);
        }

        /* Feedback states */
        .word-button.selected {
            background-color: var(--flamingo-pink);
            color: var(--white);
            border-color: var(--eerie-black);
            box-shadow: 0 0 5px rgba(255, 121, 172, 0.8);
        }

        .word-button.matched {
            background-color: var(--green-light) !important;
            border-color: var(--eerie-black) !important;
            color: var(--eerie-black) !important;
            cursor: default;
        }

        .word-button.incorrect {
            background-color: var(--red-light) !important;
            border-color: #E24F4F !important; /* A stronger red for error border */
            color: var(--eerie-black) !important;
        }

        /* Level navigation button style */
        .level-nav-button {
            padding: 8px 16px;
            font-weight: 600;
            border-radius: 9999px; /* Round button */
            background-color: transparent;
            border: 2px solid var(--flamingo-pink);
            color: var(--flamingo-pink);
            transition: background-color 0.2s, color 0.2s;
        }

        .level-nav-button.active {
            background-color: var(--flamingo-pink);
            color: var(--white);
            border-color: var(--eerie-black);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="text-center mb-8">
        <h1 class="main-title text-4xl md:text-5xl mb-1">
            Matching game
        </h1>
        <p class="text-lg text-eerie-black">test your memory</p>
    </header>

    <div class="w-full max-w-lg">
        
        <!-- Level Navigation Container -->
        <div id="level-nav" class="flex justify-center space-x-4 mb-8">
            <button class="level-nav-button active" onclick="loadLevel(1)">Nivel 1</button>
            <button class="level-nav-button" onclick="loadLevel(2)">Nivel 2</button>
            <button class="level-nav-button" onclick="loadLevel(3)">Nivel 3</button>
            <button class="level-nav-button" onclick="loadLevel(4)">Nivel 4</button>
        </div>

        <!-- Main Game Container -->
        <div id="game-container" class="grid grid-cols-2 gap-4">
            <!-- Buttons will be inserted here by JavaScript -->
        </div>

        <!-- Victory Feedback (Optional) -->
        <div id="game-message" class="mt-8 text-center text-xl font-bold text-eerie-black hidden p-4 border-2 border-flamingo-pink rounded-lg bg-red-50">
            ¡Felicidades! Nivel completado.
        </div>
    </div>

    <script>
        // --- LEVEL DATA ---
        const LEVELS = [
            // Level 1
            {
                'la gramática': 'grammar',
                'no solo': 'not only',
                'el pasado': 'past',
                'sino también': 'but also',
                'permitir': 'to allow, to permit',
                'acabar': 'to finish',
                'montar': 'to ride'
            },
            // Level 2
            {
                'acabo de comer': 'I just ate',
                'volar': 'to fly',
                'esperar': 'to wait for, to hope',
                'último': 'last',
                'todo': 'all, every',
                'cada': 'each',
                'todo el día': 'all day'
            },
            // Level 3
            {
                'el dilema': 'dilemma',
                'el drama': 'drama',
                'enamorarse de': 'to fall in love',
                'a pie': 'by foot',
                'el barco': 'boat',
                'alegrarse de': 'to become happy',
                'la bicicleta': 'bicycle'
            },
            // Level 4
            {
                'el avión': 'airplane',
                'el autobús': 'bus',
                'el metro': 'subway',
                'el automóvil': 'car',
                'olvidarse de': 'to forget',
                'divertirse': 'to enjoy oneself',
                'acordarse de': 'to remember'
            }
        ];

        // --- GLOBAL GAME STATE ---
        let gameState = {
            currentLevel: 1,
            selectedSpanish: null, // {text: 'word', element: <button>}
            selectedEnglish: null, // {text: 'word', element: <button>}
            matchedPairs: 0,
            isLocked: false // Prevents clicks during error feedback
        };

        const gameContainer = document.getElementById('game-container');
        const gameMessage = document.getElementById('game-message');

        /**
         * Shuffles an array's elements (Fisher-Yates Algorithm).
         * @param {Array<string>} array - Array of strings to shuffle.
         * @returns {Array<string>} Shuffled array.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Creates a vocabulary button.
         * @param {string} text - Button text (word).
         * @param {string} lang - 'spanish' or 'english'.
         * @returns {HTMLButtonElement} The button element.
         */
        function createButton(text, lang) {
            const button = document.createElement('button');
            button.className = 'word-button';
            button.textContent = text;
            button.dataset.lang = lang;
            button.dataset.word = text;
            
            button.onclick = () => handleWordClick(button, text, lang);
            return button;
        }

        /**
         * Renders the game grid for the current level.
         * @param {number} levelIndex - Level index (0 to 3).
         */
        function renderGame(levelIndex) {
            gameContainer.innerHTML = '';
            gameMessage.classList.add('hidden');
            gameState.matchedPairs = 0;
            gameState.selectedSpanish = null;
            gameState.selectedEnglish = null;

            const words = LEVELS[levelIndex];
            const spanishWords = Object.keys(words);
            const englishWords = Object.values(words);

            // 1. Shuffle both arrays
            const shuffledSpanish = shuffleArray([...spanishWords]);
            const shuffledEnglish = shuffleArray([...englishWords]);

            const spanishColumn = document.createElement('div');
            spanishColumn.className = 'flex flex-col space-y-3';
            
            const englishColumn = document.createElement('div');
            englishColumn.className = 'flex flex-col space-y-3';

            // 2. Create and append the buttons
            shuffledSpanish.forEach(word => {
                const button = createButton(word, 'spanish');
                spanishColumn.appendChild(button);
            });

            shuffledEnglish.forEach(word => {
                const button = createButton(word, 'english');
                englishColumn.appendChild(button);
            });

            // 3. Insert the columns into the container
            gameContainer.appendChild(spanishColumn);
            gameContainer.appendChild(englishColumn);
        }

        /**
         * Main logic when a word button is clicked.
         */
        function handleWordClick(button, text, lang) {
            if (gameState.isLocked || button.classList.contains('matched')) {
                return;
            }

            // Deselect if the same button is clicked
            if (button.classList.contains('selected')) {
                button.classList.remove('selected');
                if (lang === 'spanish') {
                    gameState.selectedSpanish = null;
                } else {
                    gameState.selectedEnglish = null;
                }
                return;
            }

            // If one is already selected in the same language, deselect it
            if (lang === 'spanish' && gameState.selectedSpanish) {
                gameState.selectedSpanish.element.classList.remove('selected');
                gameState.selectedSpanish = null;
            } else if (lang === 'english' && gameState.selectedEnglish) {
                gameState.selectedEnglish.element.classList.remove('selected');
                gameState.selectedEnglish = null;
            }

            // Select the current button
            button.classList.add('selected');
            if (lang === 'spanish') {
                gameState.selectedSpanish = { text, element: button };
            } else {
                gameState.selectedEnglish = { text, element: button };
            }

            // Check if a full pair is ready
            if (gameState.selectedSpanish && gameState.selectedEnglish) {
                checkForMatch();
            }
        }

        /**
         * Checks if the two selected buttons form a correct match.
         */
        function checkForMatch() {
            const currentWords = LEVELS[gameState.currentLevel - 1];
            const spanishWord = gameState.selectedSpanish.text;
            const englishWord = gameState.selectedEnglish.text;
            const spaBtn = gameState.selectedSpanish.element;
            const engBtn = gameState.selectedEnglish.element;

            // Temporarily lock clicks
            gameState.isLocked = true;

            // Verify match: the Spanish word must map to the English word
            const isMatch = (currentWords[spanishWord] === englishWord);

            if (isMatch) {
                // Success: Change to green and disable
                setTimeout(() => {
                    spaBtn.classList.remove('selected');
                    engBtn.classList.remove('selected');
                    
                    spaBtn.classList.add('matched');
                    engBtn.classList.add('matched');
                    
                    gameState.matchedPairs++;
                    resetSelection();
                    gameState.isLocked = false;
                    
                    if (gameState.matchedPairs === Object.keys(currentWords).length) {
                        showCompletionMessage();
                    }
                }, 300);
            } else {
                // Error: Change to red, wait, and revert
                spaBtn.classList.add('incorrect');
                engBtn.classList.add('incorrect');

                setTimeout(() => {
                    spaBtn.classList.remove('selected', 'incorrect');
                    engBtn.classList.remove('selected', 'incorrect');
                    resetSelection();
                    gameState.isLocked = false;
                }, 700); // Shows error for 0.7 seconds
            }
        }

        /**
         * Resets selection variables.
         */
        function resetSelection() {
            gameState.selectedSpanish = null;
            gameState.selectedEnglish = null;
        }

        /**
         * Displays a level completion message.
         */
        function showCompletionMessage() {
            gameMessage.textContent = '¡Felicidades! Nivel ' + gameState.currentLevel + ' completado.';
            gameMessage.classList.remove('hidden');
        }

        /**
         * Navigation function to load a new level.
         * @param {number} level - The level number (1-4).
         */
        function loadLevel(level) {
            if (level === gameState.currentLevel) {
                // Check if the current level is already active and buttons are present
                if (gameContainer.children.length > 0) return; 
            }

            gameState.currentLevel = level;
            
            // Update the 'active' state of navigation buttons
            document.querySelectorAll('.level-nav-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`#level-nav button:nth-child(${level})`).classList.add('active');

            // Render the new level
            renderGame(level - 1);
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load Level 1 on startup, ensuring the game is ready immediately.
            loadLevel(1);
        });

    </script>
</body>
</html>