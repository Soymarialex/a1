<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stem-Changing Verbs</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Inter (similar a Platform Medium en accesibilidad) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        // Configuración de Tailwind para colores y fuente personalizados
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'flamingo-pink': '#FF79AC',
                        'eerie-black': '#121118',
                        'correct-green': '#D1FAE5', // Tailwind emerald-100 / verde claro
                        'error-red': '#FEE2E2',    // Tailwind red-100 / rojo claro
                        'input-border-error': '#FCA5A5', // Tailwind red-300
                        'input-border-correct': '#6EE7B7' // Tailwind emerald-300
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos generales */
        body {
            font-family: 'Inter', sans-serif;
            background-color: white;
            color: #121118; /* Eerie Black */
            font-weight: 500; /* Medium weight */
        }
        
        /* Estilo base para los campos de texto de la Actividad B y D */
        .fill-in-input {
            border: none;
            border-bottom: 2px solid #FF79AC; /* Flamingo Pink base underline */
            margin: 0 4px;
            font-weight: bold;
            color: #121118;
            padding: 0 4px;
            width: 120px;
            text-align: center;
            background-color: transparent;
            outline: none;
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        /* Clases de validación para inputs */
        /* HE APLICADO LOS CÓDIGOS HEXADECIMALES DIRECTAMENTE AQUÍ PARA ASEGURAR LA VISUALIZACIÓN */
        .fill-in-input.is-correct {
            background-color: #D1FAE5; /* Correct Green Background */
            border-color: #6EE7B7; /* Correct Green Border */ 
        }
        .fill-in-input.is-error {
            background-color: #FEE2E2; /* Error Red Background */ 
            border-color: #FCA5A5; /* Error Red Border */ 
        }
        /* Estilos para que los inputs D sean más largos */
        .fill-in-input-long {
            min-width: 300px;
            width: auto;
            text-align: left;
        }

        /* Estilos para Drag and Drop (Actividad C) */
        .drag-option {
            cursor: grab;
            user-select: none;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .drag-option:active {
            transform: scale(0.95);
        }
        .drop-target {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            min-width: 120px;
            height: 38px;
            border: 2px dashed #FF79AC;
            border-radius: 6px;
            margin: 0 4px;
            padding: 2px 8px;
            vertical-align: middle;
            text-align: center;
            transition: background-color 0.2s, border-style 0.2s;
        }
        .drop-target.hovered {
            background-color: #FF79AC20; /* Light pink background on hover */
            border-style: solid;
        }
        .dropped-word {
            font-weight: 700;
            color: #121118;
            background-color: #FF79AC; /* Base pink */
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        /* Clases de validación para las opciones arrastradas */
        .dropped-word.is-correct {
            background-color: #6EE7B7; /* Emerald-300 for correct background */
        }
        .dropped-word.is-error {
            background-color: #FCA5A5; /* Red-300 for error background */
        }

        /* Estilo para la lista de palabras */
        .word-list {
            column-count: 1;
        }
        @media (min-width: 640px) {
            .word-list {
                column-count: 3;
            }
        }
        .list-item {
            margin-bottom: 0.5rem;
            break-inside: avoid;
        }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12">

    <!-- Encabezado Principal -->
    <header class="mb-10 text-center">
        <h1 class="text-4xl md:text-6xl font-extrabold text-eerie-black mb-2 tracking-tight">
            Stem-Changing Verbs
        </h1>
        <div class="h-1 w-24 mx-auto bg-flamingo-pink rounded-full"></div>
    </header>

    <!-- Sección de Actividades -->
    <main class="max-w-4xl mx-auto bg-white rounded-xl p-6 md:p-10 shadow-lg border border-gray-100">

        <h2 class="text-2xl md:text-3xl font-bold text-eerie-black mb-6 border-b-2 border-flamingo-pink pb-2">
            III. Actividades / Activities
        </h2>

        <!-- Actividad A: Pronunciación -->
        <section class="mb-10">
            <p class="text-xl text-eerie-black mb-4">
                <b>a. Pronuncia cada una de las palabras en esta lista.</b> / Pronounce each one of the words on this list.
            </p>
            <div class="word-list text-lg text-eerie-black">
                <p class="list-item">1. chocolate</p>
                <p class="list-item">2. hospital</p>
                <p class="list-item">3. café</p>
                <p class="list-item">4. universidad</p>
                <p class="list-item">5. palabra</p>
                <p class="list-item">6. Honduras</p>
                <p class="list-item">7. instrumento</p>
                <p class="list-item">8. ciudad</p>
                <p class="list-item">9. veintidós</p>
                <p class="list-item">10. almorzar</p>
                <p class="list-item">11. contigo</p>
                <p class="list-item">12. lecciones</p>
                <p class="list-item">13. dormir</p>
                <p class="list-item">14. actividad</p>
                <p class="list-item">15. Málaga</p>
            </div>
        </section>

        <!-- Actividad B: Diálogo (CON INPUTS y VERIFICACIÓN al presionar ENTER) -->
        <section class="mb-10">
            <p class="text-xl text-eerie-black mb-4">
                <b>b. Pablo y sus amigos Sebastián y Guillermo están hablando con Felipe. Ellos quieren convencer a Felipe de ir a la universidad.</b> / Pablo and his friends Sebastián and Guillermo are talking with Felipe. They want to convince Felipe to go to college.
            </p>
            <p class="text-lg text-eerie-black mb-4">
                <b>Completa el diálogo con la conjugación correcta del verbo indicado.</b> / Complete the dialogue with the correct conjugation of the indicated verb.
            </p>

            <div class="space-y-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <p><b>Pablo:</b> Debes tomar clases el próximo semestre [semester].</p>
                <!-- Se añade data-activity="B" para el JS -->
                <p><b>Felipe:</b> 1. <input type="text" id="b1" class="fill-in-input" data-activity="B" placeholder="preferir"> tener solo mi trabajo. No 2 <input type="text" id="b2" class="fill-in-input" data-activity="B" placeholder="querer"> estresarme [stress out] por las clases y las notas [grades].</p>
                <p><b>Sebastián:</b> Sí, nosotros 3. <input type="text" id="b3" class="fill-in-input" data-activity="B" placeholder="saber"> que no quieres estresarte, pero la universidad no es mala idea.</p>
                <p><b>Guillermo:</b> Nosotros 4. <input type="text" id="b4" class="fill-in-input" data-activity="B" placeholder="estudiar"> juntos [together] en la biblioteca. Si nosotros no 5. <input type="text" id="b5" class="fill-in-input" data-activity="B" placeholder="entender"> algo, 6. <input type="text" id="b6" class="fill-in-input" data-activity="B" placeholder="poder"> estudiar más. Los lunes, miércoles y viernes 7. <input type="text" id="b7" class="fill-in-input" data-activity="B" placeholder="almorzar"> juntos en la cafetería. Los martes y jueves yo 8. <input type="text" id="b8" class="fill-in-input" data-activity="B" placeholder="almorzar"> con mi novia.</p>
                <p><b>Felipe:</b> Yo 9. <input type="text" id="b9" class="fill-in-input" data-activity="B" placeholder="trabajar"> todos los días, entonces [so] 10. <input type="text" id="b10" class="fill-in-input" data-activity="B" placeholder="preferir"> tomar clases por la noche.</p>
                <p><b>Pablo:</b> Yo 11. <input type="text" id="b11" class="fill-in-input" data-activity="B" placeholder="creer"> que es una buena idea tomar clases por la noche.</p>
                <p><b>Felipe:</b> La universidad 12. <input type="text" id="b12" class="fill-in-input" data-activity="B" placeholder="costar"> mucho dinero, y no sé si ahora mismo 13. <input type="text" id="b13" class="fill-in-input" data-activity="B" placeholder="poder"> pagar tanto dinero [so much money].</p>
                <p><b>Sebastián:</b> Sí, es mucho dinero, pero vale la pena [it’s worth it].</p>
                <p><b>Felipe:</b> Yo 14. <input type="text" id="b14" class="fill-in-input" data-activity="B" placeholder="jugar"> al fútbol con mis amigos los sábados y domingos.</p>
                <p><b>Sebastián:</b> En la universidad también [also] 15. <input type="text" id="b15" class="fill-in-input" data-activity="B" placeholder="poder"> jugar al fútbol.</p>
                <p><b>Felipe:</b> Voy a 16. <input type="text" id="b16" class="fill-in-input" data-activity="B" placeholder="pensar"> en mis opciones [options], gracias. ¡Nos vemos!</p>
                <p><b>Pablo, Guillermo, Sebastián:</b> ¡Nos vemos!</p>
            </div>
        </section>

        <!-- Actividad C: Preposiciones (DRAG AND DROP y VERIFICACIÓN) -->
        <section class="mb-10">
            <p class="text-xl text-eerie-black mb-4">
                <b>c. Escoge la preposición o el pronombre preposicional correcto para las oraciones siguientes.</b> / Choose the correct preposition or prepositional pronoun for the following sentences.
            </p>

            <!-- Opciones arrastrables -->
            <div id="dragOptionsC" class="flex flex-wrap gap-3 mb-6 text-lg font-bold text-eerie-black bg-gray-100 p-4 rounded-lg shadow-inner">
                <div id="opt-ti" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="ti">ti</div>
                <div id="opt-mi" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="mí">mí</div>
                <div id="opt-para" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="para">para</div>
                <div id="opt-conmigo" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="conmigo">conmigo</div>
                <div id="opt-contigo" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="contigo">contigo</div>
                <div id="opt-de" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="de">de</div>
                <div id="opt-detras" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="detrás de">detrás de</div>
                <div id="opt-entre" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="entre">entre</div>
                <div id="opt-hasta" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="hasta">hasta</div>
                <div id="opt-sobre" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="sobre">sobre</div>
                <div id="opt-con" class="drag-option px-3 py-1 bg-flamingo-pink text-white rounded shadow-md" draggable="true" data-word="con">con</div>
            </div>

            <!-- Oraciones con zonas de arrastre -->
            <div class="space-y-3 text-lg text-eerie-black">
                <p>1. Los lunes tengo clases <span id="c1" class="drop-target" data-activity="C"></span> las nueve de la mañana y las cinco menos diez de la tarde.</p>
                <p>2. En la clase hablamos <span id="c2a" class="drop-target" data-activity="C"></span> la situación política <span id="c2b" class="drop-target" data-activity="C"></span> Cuba.</p>
                <p>3. Hablo <span id="c3" class="drop-target" data-activity="C"></span> mis amigos todos los días.</p>
                <p>4. ¿Quieres ir al seminario [seminar] de esta noche <span id="c4" class="drop-target" data-activity="C"></span>?</p>
                <p>5. Esta tarea [homework] es <span id="c5" class="drop-target" data-activity="C"></span> la clase de inglés.</p>
                <p>6. Quiero ir a la fiesta, pero sin <span id="c6" class="drop-target" data-activity="C"></span> no voy a ir.</p>
                <p>7. Todos los días duermo <span id="c7" class="drop-target" data-activity="C"></span> las ocho de la mañana.</p>
                <p>8. Shhhh, la profesora está <span id="c8" class="drop-target" data-activity="C"></span> nosotros.</p>
            </div>
        </section>

        <!-- Actividad D: Preguntas y Respuestas (CON INPUTS y VERIFICACIÓN) -->
        <section class="mb-10">
            <p class="text-xl text-eerie-black mb-4">
                <b>d. Completa las respuestas de las siguientes preguntas. No olvides conjugar el verbo.</b> / Complete the answers to the following questions. Don’t forget to conjugate the verb.
            </p>
            <div class="space-y-3 text-lg text-eerie-black">
                <!-- Inputs sin placeholder y con clase para longitud -->
                <p>1. ¿Juegas mucho al fútbol los fines de semana? <b>No,</b> <input type="text" id="d1" class="fill-in-input fill-in-input-long" data-activity="D"> .</p>
                <p>2. ¿Generalmente mientes a tus amigos? <b>No,</b> <input type="text" id="d2" class="fill-in-input fill-in-input-long" data-activity="D"> .</p>
                <p>3. ¿Pierdes las llaves [keys] de tu carro frecuentemente [frequently]? <b>Sí,</b> <input type="text" id="d3" class="fill-in-input fill-in-input-long" data-activity="D"> .</p>
                <p>4. ¿Cuánto cuesta un buen diccionario? <input type="text" id="d4" class="fill-in-input fill-in-input-long" data-activity="D"> por lo menos [at least] veinte dólares.</p>
                <p>5. ¿A qué hora almuerzas? <input type="text" id="d5" class="fill-in-input fill-in-input-long" data-activity="D"> al mediodía.</p>
                <p>6. ¿Entiendes los verbos con cambio de raíz en el presente? <b>Sí,</b> <input type="text" id="d6" class="fill-in-input fill-in-input-long" data-activity="D"> .</p>
            </div>
        </section>

    </main>

    <!-- Sección de Respuestas (Inicialmente oculta y con botón para revelar) -->
    <section class="max-w-4xl mx-auto mt-12 mb-12">
        <button id="toggleAnswers" 
                class="w-full md:w-auto px-8 py-3 bg-flamingo-pink text-white font-bold rounded-lg shadow-md hover:bg-pink-400 transition duration-300">
            Mostrar Respuestas Correctas
        </button>

        <div id="correctAnswers" class="mt-8 p-6 md:p-10 bg-gray-100 rounded-xl shadow-inner border border-flamingo-pink/50 hidden">
            <h2 class="text-2xl md:text-3xl font-bold text-eerie-black mb-6 border-b-2 border-eerie-black pb-2">
                IV. Respuestas correctas / Correct Answers
            </h2>

            <!-- Respuestas Actividad A -->
            <div class="mb-8">
                <p class="text-xl font-bold text-eerie-black mb-4">a.</p>
                <div class="word-list text-lg text-eerie-black font-semibold">
                    <p class="list-item">1. chocolate</p>
                    <p class="list-item">2. hospital</p>
                    <p class="list-item">3. café</p>
                    <p class="list-item">4. universidad</p>
                    <p class="list-item">5. palabra</p>
                    <p class="list-item">6. Honduras</p>
                    <p class="list-item">7. instrumento</p>
                    <p class="list-item">8. ciudad</p>
                    <p class="list-item">9. veintidós</p>
                    <p class="list-item">10. almorzar</p>
                    <p class="list-item">11. contigo</p>
                    <p class="list-item">12. lecciones</p>
                    <p class="list-item">13. dormir</p>
                    <p class="list-item">14. actividad</p>
                    <p class="list-item">15. Málaga</p>
                </div>
            </div>

            <!-- Respuestas Actividad B -->
            <div class="mb-8">
                <p class="text-xl font-bold text-eerie-black mb-4">b.</p>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-x-4 gap-y-2 text-lg text-eerie-black">
                    <p>1. <b class="text-flamingo-pink">Prefiero</b></p>
                    <p>9. <b class="text-flamingo-pink">trabajo</b></p>
                    <p>2. <b class="text-flamingo-pink">quiero</b></p>
                    <p>10. <b class="text-flamingo-pink">prefiero</b></p>
                    <p>3. <b class="text-flamingo-pink">sabemos</b></p>
                    <p>11. <b class="text-flamingo-pink">creo</b></p>
                    <p>4. <b class="text-flamingo-pink">estudiamos</b></p>
                    <p>12. <b class="text-flamingo-pink">cuesta</b></p>
                    <p>5. <b class="text-flamingo-pink">entendemos</b></p>
                    <p>13. <b class="text-flamingo-pink">puedo</b></p>
                    <p>6. <b class="text-flamingo-pink">podemos</b></p>
                    <p>14. <b class="text-flamingo-pink">juego</b></p>
                    <p>7. <b class="text-flamingo-pink">almorzamos</b></p>
                    <p>15. <b class="text-flamingo-pink">puedes</b></p>
                    <p>8. <b class="text-flamingo-pink">almuerzo</b></p>
                    <p>16. <b class="text-flamingo-pink">pensar</b></p>
                </div>
            </div>

            <!-- Respuestas Actividad C -->
            <div class="mb-8">
                <p class="text-xl font-bold text-eerie-black mb-4">c.</p>
                <div class="space-y-2 text-lg text-eerie-black">
                    <p>1. <b class="text-flamingo-pink">entre</b></p>
                    <p>2. <b class="text-flamingo-pink">sobre</b> / <b class="text-flamingo-pink">de</b> &nbsp;...&nbsp; <b class="text-flamingo-pink">de</b></p>
                    <p>3. <b class="text-flamingo-pink">con</b></p>
                    <p>4. <b class="text-flamingo-pink">conmigo</b></p>
                    <p>5. <b class="text-flamingo-pink">para</b></p>
                    <p>6. <b class="text-flamingo-pink">ti</b></p>
                    <p>7. <b class="text-flamingo-pink">hasta</b></p>
                    <p>8. <b class="text-flamingo-pink">detrás de</b></p>
                </div>
            </div>

            <!-- Respuestas Actividad D -->
            <div>
                <p class="text-xl font-bold text-eerie-black mb-4">d.</p>
                <div class="space-y-2 text-lg text-eerie-black">
                    <p>1. No, <b class="text-flamingo-pink">no juego mucho al fútbol los fines de semana</b>.</p>
                    <p>2. No, <b class="text-flamingo-pink">no miento a mis amigos</b>.</p>
                    <p>3. Sí, <b class="text-flamingo-pink">pierdo las llaves de mi carro frecuentemente</b>.</p>
                    <p>4. Un buen diccionario <b class="text-flamingo-pink">cuesta</b> por lo menos veinte dólares.</p>
                    <p>5. <b class="text-flamingo-pink">Almuerzo</b> al mediodía.</p>
                    <p>6. Sí, <b class="text-flamingo-pink">entiendo los verbos con cambio de raíz en el presente</b>.</p>
                </div>
            </div>

        </div>
    </section>

    <script>
        // --- DATA DE RESPUESTAS CORRECTAS ---
        const correctAnswersB = {
            'b1': 'prefiero', 'b2': 'quiero', 'b3': 'sabemos', 'b4': 'estudiamos',
            'b5': 'entendemos', 'b6': 'podemos', 'b7': 'almorzamos', 'b8': 'almuerzo',
            'b9': 'trabajo', 'b10': 'prefiero', 'b11': 'creo', 'b12': 'cuesta',
            'b13': 'puedo', 'b14': 'juego', 'b15': 'puedes', 'b16': 'pensar'
        };

        const correctAnswersD = {
            // Respuestas ajustadas para coincidir con lo que el usuario debe escribir DENTRO del input.
            // Los prefijos (No, Sí) ya están en el HTML.
            'd1': 'no juego mucho al fútbol los fines de semana',
            'd2': 'no miento a mis amigos',
            'd3': 'pierdo las llaves de mi carro frecuentemente', 
            'd4': 'cuesta',
            'd5': 'almuerzo',
            'd6': 'entiendo los verbos con cambio de raíz en el presente'
        };

        const correctAnswersC = {
            'c1': ['entre'],
            'c2a': ['sobre', 'de'], // Las dos opciones correctas
            'c2b': ['de'],
            'c3': ['con'],
            'c4': ['conmigo'],
            'c5': ['para'],
            'c6': ['ti'],
            'c7': ['hasta'],
            'c8': ['detrás de']
        };
        
        // --- FUNCIÓN DE NORMALIZACIÓN ---
        function normalize(text) {
            if (!text) return '';
            // Elimina acentos, pasa a minúsculas, quita puntuación y espacios extra.
            return text.toLowerCase().trim()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "") 
                .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"") 
                .replace(/\s{2,}/g," ");
        }

        // --- LÓGICA DE VALIDACIÓN PARA INPUTS (ACTIVIDADES B y D) ---

        /**
         * Verifica el valor del input y aplica la clase de color correspondiente.
         * @param {Event} event - El evento que dispara la validación (blur o keydown).
         */
        function validateInput(event) {
            const input = event.target;
            const value = normalize(input.value);
            const id = input.id;
            const activity = input.dataset.activity;
            let correctValue = null;

            if (activity === 'B') {
                correctValue = correctAnswersB[id];
            } else if (activity === 'D') {
                correctValue = correctAnswersD[id];
            }
            
            // 1. Limpia las clases de estado
            input.classList.remove('is-correct', 'is-error');

            if (value === '') {
                // Si está vacío, solo limpiamos las clases y la base CSS aplica el estilo normal
                return;
            }

            // 2. Realiza la validación y aplica la clase de color
            if (correctValue && value === normalize(correctValue)) {
                input.classList.add('is-correct');
            } else {
                input.classList.add('is-error');
            }
        }
        
        // --- FUNCIÓN PARA EL MANEJO DEL TECLA ENTER EN LA ACTIVIDAD B ---
        function handleEnterKeyB(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Evita la acción por defecto
                
                const currentInput = event.target;
                
                // 1. VERIFICAR INMEDIATAMENTE (aplica color)
                validateInput({ target: currentInput }); 
                
                // 2. Encuentra todos los inputs de la Actividad B
                const allBInputs = Array.from(document.querySelectorAll('.fill-in-input[data-activity="B"]'));
                const currentIndex = allBInputs.indexOf(currentInput);
                
                // 3. Mueve el foco al siguiente input si existe
                if (currentIndex !== -1 && currentIndex < allBInputs.length - 1) {
                    allBInputs[currentIndex + 1].focus();
                } else if (currentIndex === allBInputs.length - 1) {
                    // Si es el último, quita el foco
                    currentInput.blur();
                }
            }
        }

        // Asigna listeners a todos los inputs
        document.querySelectorAll('.fill-in-input').forEach(input => {
            const activity = input.dataset.activity;
            
            if (activity === 'B') {
                // Listener para Enter que verifica y salta
                input.addEventListener('keydown', handleEnterKeyB); 
            } 
            
            // Listener 'blur' para verificar cuando el usuario sale del campo (Actividades B y D)
            input.addEventListener('blur', validateInput); 
        });

        // --- LÓGICA DRAG AND DROP (ACTIVIDAD C) CON VERIFICACIÓN ---

        let draggedElement = null;

        function handleDragStart(event) {
            draggedElement = event.target;
            event.dataTransfer.setData('text/plain', draggedElement.dataset.word);
            event.dataTransfer.effectAllowed = 'move';
            
            setTimeout(() => {
                draggedElement.style.opacity = '0.5';
            }, 0);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            event.currentTarget.classList.add('hovered');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('hovered');
        }

        /** Devuelve la opción arrastrada a su fuente original y limpia el dropTarget. */
        function returnOption(word, dropTarget) {
             const originalOption = document.querySelector(`#dragOptionsC [data-word="${word}"]`);
            if (originalOption) {
                originalOption.classList.remove('hidden');
                originalOption.style.opacity = '1';
                dropTarget.innerHTML = ''; // Limpia el objetivo de arrastre
            }
        }

        function validateDropTarget(targetId, word) {
            const normalizedWord = normalize(word);
            const correctWords = correctAnswersC[targetId];

            if (correctWords && correctWords.map(w => normalize(w)).includes(normalizedWord)) {
                return true;
            }
            return false;
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('hovered');

            const dropTarget = event.currentTarget;
            const word = event.dataTransfer.getData('text/plain');
            const targetId = dropTarget.id;

            // 1. Verifica si el destino ya tiene un elemento
            if (dropTarget.querySelector('.dropped-word')) {
                 if (draggedElement) {
                    draggedElement.style.opacity = '1';
                 }
                return;
            }

            // 2. Crea la representación visual de la palabra soltada
            const droppedWordSpan = document.createElement('span');
            droppedWordSpan.textContent = word;
            droppedWordSpan.classList.add('dropped-word', 'text-eerie-black'); 
            
            // 3. VERIFICACIÓN AL SOLTAR (aplica color)
            const isCorrect = validateDropTarget(targetId, word);
            if (isCorrect) {
                droppedWordSpan.classList.add('is-correct');
            } else {
                droppedWordSpan.classList.add('is-error');
            }

            // 4. Función para devolver la palabra a la lista original (al hacer clic)
            droppedWordSpan.addEventListener('click', function() {
                // El clic devuelve la opción (funcionalidad solicitada)
                returnOption(word, dropTarget); 
            });

            // 5. Coloca la palabra en el destino
            dropTarget.appendChild(droppedWordSpan);
            
            // 6. Oculta el elemento original de la lista
            if (draggedElement) {
                draggedElement.classList.add('hidden'); 
            }
        }

        // Inicializa los listeners de arrastrar y soltar
        function initializeDragAndDrop() {
            // A. Inicializar opciones arrastrables
            document.querySelectorAll('.drag-option').forEach(option => {
                option.addEventListener('dragstart', handleDragStart);
            });

            // B. Inicializar zonas de arrastre
            document.querySelectorAll('.drop-target').forEach(target => {
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('dragleave', handleDragLeave);
                target.addEventListener('drop', handleDrop);
            });
        }
        
        // Lógica para mostrar/ocultar las respuestas
        document.getElementById('toggleAnswers').addEventListener('click', function() {
            const answers = document.getElementById('correctAnswers');
            const button = document.getElementById('toggleAnswers');
            
            if (answers.classList.contains('hidden')) {
                answers.classList.remove('hidden');
                button.textContent = 'Ocultar Respuestas Correctas';
            } else {
                answers.classList.add('hidden');
                button.textContent = 'Mostrar Respuestas Correctas';
            }
        });

        // Ejecuta la inicialización cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', initializeDragAndDrop);
    </script>

</body>
</html>
